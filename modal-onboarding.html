<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  /* =======================================================================
     Pikaso Design Tokens — Inlined for Braze iframe isolation
     Based on Figma: CRM - Inapps (node 37-159)
     Theme-aware: detects light/dark from parent app
     Variant: modal_onboarding (multi-step carousel with thumbnails)
     ======================================================================= */

  @font-face {
    font-family: 'Inter';
    src: url('https://pikaso.cdnpk.net/public/media/Inter-Regular.woff2') format('woff2'),
         url('https://pikaso.cdnpk.net/public/media/Inter-Regular.woff') format('woff');
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }

  @font-face {
    font-family: 'Inter';
    src: url('https://pikaso.cdnpk.net/public/media/Inter-SemiBold.woff2') format('woff2'),
         url('https://pikaso.cdnpk.net/public/media/Inter-SemiBold.woff') format('woff');
    font-weight: 600;
    font-style: normal;
    font-display: swap;
  }

  /* =====================================================================
     Light theme (default)
     ===================================================================== */
  :root {
    --modal-overlay: hsla(0, 0%, 0%, 0.5);
    --modal-radius: 24px;
    --modal-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    --modal-font: 'Inter', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    --modal-max-width: 860px;

    --modal-bg: hsl(0, 0%, 100%);
    --modal-title-color: hsl(0, 0%, 5%);
    --modal-text-color: hsl(0, 0%, 36%);

    --modal-cta-bg: hsl(0, 0%, 5%);
    --modal-cta-bg-hover: hsl(0, 0%, 26%);
    --modal-cta-bg-active: hsl(0, 0%, 36%);
    --modal-cta-color: hsl(0, 0%, 100%);

    --modal-border: rgba(13, 13, 13, 0.2);

    --modal-close-bg: hsla(0, 0%, 47%, 0.1);
    --modal-close-bg-hover: hsla(0, 0%, 47%, 0.15);
    --modal-close-color: hsl(0, 0%, 5%);

    --thumb-border-active: hsl(0, 0%, 5%);
    --thumb-border-inactive: transparent;
  }

  /* =====================================================================
     Dark theme
     ===================================================================== */
  .dark {
    --modal-bg: hsl(0, 0%, 12%);
    --modal-title-color: hsl(0, 0%, 97%);
    --modal-text-color: hsl(0, 0%, 69%);

    --modal-cta-bg: hsl(0, 0%, 97%);
    --modal-cta-bg-hover: hsl(0, 0%, 90%);
    --modal-cta-bg-active: hsl(0, 0%, 85%);
    --modal-cta-color: hsl(0, 0%, 5%);

    --modal-border: hsla(0, 0%, 100%, 0.2);

    --modal-close-bg: hsla(0, 0%, 100%, 0.1);
    --modal-close-bg-hover: hsla(0, 0%, 100%, 0.15);
    --modal-close-color: hsl(0, 0%, 97%);

    --thumb-border-active: hsl(0, 0%, 97%);
    --thumb-border-inactive: transparent;
  }

  /* =======================================================================
     Reset & Base
     ======================================================================= */

  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: var(--modal-font);
    font-size: 16px;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* =======================================================================
     Overlay
     ======================================================================= */

  .braze-modal-overlay {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--modal-overlay);
    z-index: 9999;
    padding: 48px 16px 16px;
    opacity: 0;
    animation: fadeIn 0.2s ease-out forwards;
  }

  /* =======================================================================
     Modal Card — horizontal layout
     ======================================================================= */

  .braze-modal-wrapper {
    position: relative;
    width: 100%;
    max-width: var(--modal-max-width);
    opacity: 0;
    transform: scale(0.95);
    filter: blur(12px);
    animation: scaleIn 0.35s cubic-bezier(0.16, 1, 0.3, 1) 0.05s forwards;
  }

  .braze-modal {
    position: relative;
    width: 100%;
    max-height: 90vh;
    background: var(--modal-bg);
    border-radius: var(--modal-radius);
    box-shadow: var(--modal-shadow);
    overflow: hidden;
    display: flex;
    flex-direction: row;
  }

  .braze-modal::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: var(--modal-radius);
    box-shadow: inset 0 0 0 1px var(--modal-border);
    pointer-events: none;
    z-index: 3;
  }

  /* =======================================================================
     Close Button
     ======================================================================= */

  .braze-modal__close {
    position: absolute;
    bottom: calc(100% + 8px);
    right: 0;
    z-index: 2;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--modal-close-bg);
    border: none;
    border-radius: 9999px;
    cursor: pointer;
    transition: background 0.15s ease;
  }

  .braze-modal__close:hover { background: var(--modal-close-bg-hover); }
  .braze-modal__close svg { width: 14px; height: 14px; color: var(--modal-close-color); }

  /* =======================================================================
     Content — left side, ~45%
     ======================================================================= */

  .braze-modal__content {
    width: 45%;
    padding: 32px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    overflow-y: auto;
    flex-shrink: 0;
  }

  .braze-modal__title {
    font-size: 1.25rem;
    font-weight: 600;
    line-height: 1.4;
    color: var(--modal-title-color);
  }

  .braze-modal__text {
    font-size: 0.875rem;
    font-weight: 400;
    line-height: 1.6;
    color: var(--modal-text-color);
  }

  .braze-modal__list {
    list-style: disc;
    padding-left: 20px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .braze-modal__list li {
    font-size: 0.875rem;
    font-weight: 400;
    line-height: 1.6;
    color: var(--modal-text-color);
  }

  /* Step counter */
  .braze-modal__step-counter {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--modal-text-color);
    opacity: 0.6;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* =======================================================================
     CTA — bottom-right of content area
     ======================================================================= */

  .braze-modal__cta-wrapper {
    display: flex;
    justify-content: flex-end;
    margin-top: auto;
    padding-top: 8px;
    gap: 8px;
  }

  .braze-modal__cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 40px;
    padding: 0 16px;
    font-family: var(--modal-font);
    font-size: 0.875rem;
    font-weight: 600;
    line-height: 1;
    color: var(--modal-cta-color);
    background: var(--modal-cta-bg);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-decoration: none;
    transition: background 0.15s ease-in-out;
    white-space: nowrap;
  }

  .braze-modal__cta:hover { background: var(--modal-cta-bg-hover); }
  .braze-modal__cta:active { background: var(--modal-cta-bg-active); }

  /* =======================================================================
     Carousel — right side, ~55%
     ======================================================================= */

  .braze-modal__carousel {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 24px 24px 24px 0;
    gap: 16px;
  }

  /* Main image — 1:1 aspect ratio */
  .braze-modal__carousel-main {
    position: relative;
    aspect-ratio: 1 / 1;
    border-radius: 16px;
    overflow: hidden;
    background: hsl(0, 0%, 8%);
  }

  .braze-modal__carousel-main img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .braze-modal__carousel-main img.active {
    opacity: 1;
  }

  /* Thumbnail strip */
  .braze-modal__carousel-thumbs {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  .braze-modal__thumb {
    flex: 1;
    aspect-ratio: 1 / 1;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    border: 1px solid transparent;
    transition: border-color 0.2s ease, opacity 0.2s ease;
    opacity: 0.5;
    padding: 0;
    background: none;
  }

  .braze-modal__thumb.active {
    border-color: var(--modal-border);
    opacity: 1;
  }

  .braze-modal__thumb:hover {
    opacity: 0.8;
  }

  .braze-modal__thumb.active:hover {
    opacity: 1;
  }

  .braze-modal__thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* =======================================================================
     Animations
     ======================================================================= */

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  @keyframes scaleIn {
    from { opacity: 0; transform: scale(0.95); filter: blur(12px); }
    to { opacity: 1; transform: scale(1); filter: blur(0); }
  }

  @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

  @keyframes scaleOut {
    from { opacity: 1; transform: scale(1); filter: blur(0); }
    to { opacity: 0; transform: scale(0.95); filter: blur(12px); }
  }

  .braze-modal-overlay--closing { animation: fadeOut 0.15s ease-in forwards; }
  .braze-modal-overlay--closing .braze-modal-wrapper { animation: scaleOut 0.15s ease-in forwards; }

  /* =======================================================================
     Responsive
     ======================================================================= */

  /* Close button stays above the modal on all screen sizes */

  @media (max-width: 768px) {
    .braze-modal {
      flex-direction: column;
      max-height: 90vh;
      overflow-y: auto;
    }

    .braze-modal__carousel {
      order: -1;
      padding: 16px 16px 0;
    }

    .braze-modal-wrapper {
      max-width: 520px;
    }

    .braze-modal__content {
      width: 100%;
      padding: 24px;
    }
  }

  @media (max-width: 425px) {
    .braze-modal-wrapper {
      max-width: 100%;
    }
  }
</style>
</head>
<body>
  <!--
    Braze Custom HTML In-App Message Template: Onboarding Modal
    =============================================================
    Design source: Figma CRM - Inapps (node 37-159)
    Layout: horizontal — content left, image carousel right
    Theme: auto-detects light/dark from parent app
    Steps: configurable via data-step attributes

    To use this template:
      1. Configure steps in the STEPS array in the <script> section
      2. Set translation keys in the hidden spans
      3. Update image URLs for each step
  -->

  <!-- =====================================================================
       Lokalise translations: only user language + English fallback (2 requests).
       Language detected via Braze ${language} attribute (set by setLanguage() in app).
       ===================================================================== -->
  {%- assign lang = ${language} | default: 'en' -%}
  {%- case lang -%}
    {%- when 'es' -%}{%- assign lok_lang = 'es_ES' -%}
    {%- when 'pt' -%}{%- assign lok_lang = 'pt_BR' -%}
    {%- when 'de' -%}{%- assign lok_lang = 'de_DE' -%}
    {%- when 'fr' -%}{%- assign lok_lang = 'fr_FR' -%}
    {%- when 'it' -%}{%- assign lok_lang = 'it_IT' -%}
    {%- when 'ru' -%}{%- assign lok_lang = 'ru_RU' -%}
    {%- when 'ja' -%}{%- assign lok_lang = 'ja_JP' -%}
    {%- when 'ko' -%}{%- assign lok_lang = 'ko_KR' -%}
    {%- when 'nl' -%}{%- assign lok_lang = 'nl_NL' -%}
    {%- when 'pl' -%}{%- assign lok_lang = 'pl_PL' -%}
    {%- when 'zh' -%}{%- assign lok_lang = 'zh_HK' -%}
    {%- when 'hi' -%}{%- assign lok_lang = 'hi_IN' -%}
    {%- when 'cs' -%}{%- assign lok_lang = 'cs_CZ' -%}
    {%- when 'da' -%}{%- assign lok_lang = 'da_DK' -%}
    {%- when 'fi' -%}{%- assign lok_lang = 'fi_FI' -%}
    {%- when 'nb' -%}{%- assign lok_lang = 'nb_NO' -%}
    {%- when 'sv' -%}{%- assign lok_lang = 'sv_SE' -%}
    {%- when 'tr' -%}{%- assign lok_lang = 'tr_TR' -%}
    {%- when 'id' -%}{%- assign lok_lang = 'id_ID' -%}
    {%- when 'vi' -%}{%- assign lok_lang = 'vi_VN' -%}
    {%- when 'th' -%}{%- assign lok_lang = 'th_TH' -%}
    {%- else -%}{%- assign lok_lang = 'en' -%}
  {%- endcase -%}
  {%- assign base = 'https://exports.live.lokalise.cloud/braze/64903509694141adaff9b6.83125809/a4597de8e0ea203a9d9cc0266d7f1fed9fa4a0c1/' -%}
  {%- connected_content {{ base }}en.json :save t_en :cache_max_age 3600 -%}
  {%- if t_en == null -%}{%- abort_message("Lokalise EN fallback failed") -%}{%- endif -%}
  {%- if lok_lang != 'en' -%}
    {%- assign json_url = base | append: lok_lang | append: '.json' -%}
    {%- connected_content {{ json_url }} :save t :cache_max_age 3600 -%}
  {%- else -%}
    {%- assign t = t_en -%}
  {%- endif -%}

  <div class="braze-modal-overlay" id="brazeModalOverlay">
    <div class="braze-modal-wrapper">

      <button class="braze-modal__close" id="brazeModalClose" aria-label="Close" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="4" x2="12" y2="12" />
          <line x1="12" y1="4" x2="4" y2="12" />
        </svg>
      </button>

      <div class="braze-modal" role="dialog" aria-modal="true" aria-labelledby="brazeModalTitle">

        <!-- Content: left side -->
        <div class="braze-modal__content">
          <span class="braze-modal__step-counter" id="brazeStepCounter">Step 1 of 6</span>
          <h2 class="braze-modal__title" id="brazeModalTitle">Step title</h2>
          <p class="braze-modal__text" id="brazeModalText">Step description text goes here.</p>
          <div class="braze-modal__cta-wrapper">
            <a class="braze-modal__cta" id="brazeModalCta" href="#" role="button">Next</a>
          </div>
        </div>

        <!-- Carousel: right side -->
        <div class="braze-modal__carousel">
          <div class="braze-modal__carousel-main" id="brazeCarouselMain">
            <!-- Images are injected by JS from STEPS config -->
          </div>
          <div class="braze-modal__carousel-thumbs" id="brazeCarouselThumbs">
            <!-- Thumbnails are injected by JS from STEPS config -->
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    (function () {
      /* =================================================================
         STEP CONFIGURATION
         Replace image URLs, titles, texts, and CTA labels per step.
         ================================================================= */
      var STEPS = [
        {
          image: '${step1_image}',
          title: '{{ t.STEP1_TITLE_KEY | default: t_en.STEP1_TITLE_KEY }}',
          text:  '{{ t.STEP1_TEXT_KEY | default: t_en.STEP1_TEXT_KEY }}',
          cta:   '{{ t.STEP1_CTA_KEY | default: t_en.STEP1_CTA_KEY }}',
          url:   ''
        },
        {
          image: '${step2_image}',
          title: '{{ t.STEP2_TITLE_KEY | default: t_en.STEP2_TITLE_KEY }}',
          text:  '{{ t.STEP2_TEXT_KEY | default: t_en.STEP2_TEXT_KEY }}',
          cta:   '{{ t.STEP2_CTA_KEY | default: t_en.STEP2_CTA_KEY }}',
          url:   ''
        },
        {
          image: '${step3_image}',
          title: '{{ t.STEP3_TITLE_KEY | default: t_en.STEP3_TITLE_KEY }}',
          text:  '{{ t.STEP3_TEXT_KEY | default: t_en.STEP3_TEXT_KEY }}',
          cta:   '{{ t.STEP3_CTA_KEY | default: t_en.STEP3_CTA_KEY }}',
          url:   ''
        },
        {
          image: '${step4_image}',
          title: '{{ t.STEP4_TITLE_KEY | default: t_en.STEP4_TITLE_KEY }}',
          text:  '{{ t.STEP4_TEXT_KEY | default: t_en.STEP4_TEXT_KEY }}',
          cta:   '{{ t.STEP4_CTA_KEY | default: t_en.STEP4_CTA_KEY }}',
          url:   ''
        },
        {
          image: '${step5_image}',
          title: '{{ t.STEP5_TITLE_KEY | default: t_en.STEP5_TITLE_KEY }}',
          text:  '{{ t.STEP5_TEXT_KEY | default: t_en.STEP5_TEXT_KEY }}',
          cta:   '{{ t.STEP5_CTA_KEY | default: t_en.STEP5_CTA_KEY }}',
          url:   ''
        },
        {
          image: '${step6_image}',
          title: '{{ t.STEP6_TITLE_KEY | default: t_en.STEP6_TITLE_KEY }}',
          text:  '{{ t.STEP6_TEXT_KEY | default: t_en.STEP6_TEXT_KEY }}',
          cta:   '{{ t.STEP6_CTA_KEY | default: t_en.STEP6_CTA_KEY }}',
          url:   '${final_cta_url}'
        }
      ];

      var currentStep = 0;

      /* -----------------------------------------------------------------
         Theme detection
         ----------------------------------------------------------------- */
      try {
        var parentDoc = window.parent.document.documentElement;
        if (parentDoc && parentDoc.classList.contains('dark')) {
          document.documentElement.classList.add('dark');
        }
      } catch (e) {}

      /* -----------------------------------------------------------------
         Build carousel images and thumbnails
         ----------------------------------------------------------------- */
      var mainContainer = document.getElementById('brazeCarouselMain');
      var thumbContainer = document.getElementById('brazeCarouselThumbs');

      STEPS.forEach(function (step, i) {
        var img = document.createElement('img');
        img.src = step.image;
        img.alt = 'Step ' + (i + 1);
        img.loading = i === 0 ? 'eager' : 'lazy';
        if (i === 0) img.classList.add('active');
        mainContainer.appendChild(img);

        var thumb = document.createElement('button');
        thumb.className = 'braze-modal__thumb' + (i === 0 ? ' active' : '');
        thumb.setAttribute('aria-label', 'Go to step ' + (i + 1));
        thumb.setAttribute('type', 'button');
        var thumbImg = document.createElement('img');
        thumbImg.src = step.image;
        thumbImg.alt = '';
        thumb.appendChild(thumbImg);
        thumb.addEventListener('click', function () { goToStep(i); });
        thumbContainer.appendChild(thumb);
      });

      /* -----------------------------------------------------------------
         Step navigation
         ----------------------------------------------------------------- */
      function goToStep(index) {
        if (index < 0 || index >= STEPS.length) return;
        currentStep = index;

        var mainImages = mainContainer.querySelectorAll('img');
        for (var i = 0; i < mainImages.length; i++) {
          mainImages[i].classList.toggle('active', i === index);
        }

        var thumbs = thumbContainer.querySelectorAll('.braze-modal__thumb');
        for (var j = 0; j < thumbs.length; j++) {
          thumbs[j].classList.toggle('active', j === index);
        }

        var step = STEPS[index];
        document.getElementById('brazeModalTitle').textContent = step.title;
        document.getElementById('brazeModalText').textContent = step.text;
        document.getElementById('brazeModalCta').textContent = step.cta;
        document.getElementById('brazeStepCounter').textContent = 'Step ' + (index + 1) + ' of ' + STEPS.length;

        if (step.url) {
          document.getElementById('brazeModalCta').setAttribute('href', step.url);
        }
      }

      goToStep(0);

      /* -----------------------------------------------------------------
         Close modal with animation
         ----------------------------------------------------------------- */
      function closeModal() {
        var overlay = document.getElementById('brazeModalOverlay');
        if (!overlay) return;
        overlay.classList.add('braze-modal-overlay--closing');
        overlay.addEventListener('animationend', function () {
          if (typeof brazeBridge !== 'undefined') brazeBridge.closeMessage();
        });
        setTimeout(function () {
          if (typeof brazeBridge !== 'undefined') brazeBridge.closeMessage();
        }, 300);
      }

      /* Close button */
      var closeBtn = document.getElementById('brazeModalClose');
      if (closeBtn) closeBtn.addEventListener('click', function (e) { e.preventDefault(); closeModal(); });

      /* Overlay click */
      var overlay = document.getElementById('brazeModalOverlay');
      if (overlay) overlay.addEventListener('click', function (e) { if (e.target === overlay) closeModal(); });

      /* CTA button — next step or final action */
      var ctaBtn = document.getElementById('brazeModalCta');
      if (ctaBtn) {
        ctaBtn.addEventListener('click', function (e) {
          e.preventDefault();

          if (currentStep < STEPS.length - 1) {
            goToStep(currentStep + 1);
          } else {
            if (typeof brazeBridge !== 'undefined') brazeBridge.logClick();
            var url = ctaBtn.getAttribute('href');
            if (url && url !== '#' && url !== '${final_cta_url}' && url.trim() !== '') {
              window.parent.location.href = url;
            }
            closeModal();
          }
        });
      }

      /* Escape key */
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' || e.keyCode === 27) closeModal();
        if (e.key === 'ArrowRight' || e.keyCode === 39) goToStep(currentStep + 1);
        if (e.key === 'ArrowLeft' || e.keyCode === 37) goToStep(currentStep - 1);
      });
    })();
  </script>
</body>
</html>
